<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">

<head>

<meta charset="utf-8">
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="generator" content="pandoc" />

<meta name="viewport" content="width=device-width, initial-scale=1">


<meta name="date" content="2016-05-27" />

<title>Searching DataONE Data Holdings</title>



<style type="text/css">code{white-space: pre;}</style>
<style type="text/css">
div.sourceCode { overflow-x: auto; }
table.sourceCode, tr.sourceCode, td.lineNumbers, td.sourceCode {
  margin: 0; padding: 0; vertical-align: baseline; border: none; }
table.sourceCode { width: 100%; line-height: 100%; }
td.lineNumbers { text-align: right; padding-right: 4px; padding-left: 4px; color: #aaaaaa; border-right: 1px solid #aaaaaa; }
td.sourceCode { padding-left: 5px; }
code > span.kw { color: #007020; font-weight: bold; } /* Keyword */
code > span.dt { color: #902000; } /* DataType */
code > span.dv { color: #40a070; } /* DecVal */
code > span.bn { color: #40a070; } /* BaseN */
code > span.fl { color: #40a070; } /* Float */
code > span.ch { color: #4070a0; } /* Char */
code > span.st { color: #4070a0; } /* String */
code > span.co { color: #60a0b0; font-style: italic; } /* Comment */
code > span.ot { color: #007020; } /* Other */
code > span.al { color: #ff0000; font-weight: bold; } /* Alert */
code > span.fu { color: #06287e; } /* Function */
code > span.er { color: #ff0000; font-weight: bold; } /* Error */
code > span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
code > span.cn { color: #880000; } /* Constant */
code > span.sc { color: #4070a0; } /* SpecialChar */
code > span.vs { color: #4070a0; } /* VerbatimString */
code > span.ss { color: #bb6688; } /* SpecialString */
code > span.im { } /* Import */
code > span.va { color: #19177c; } /* Variable */
code > span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code > span.op { color: #666666; } /* Operator */
code > span.bu { } /* BuiltIn */
code > span.ex { } /* Extension */
code > span.pp { color: #bc7a00; } /* Preprocessor */
code > span.at { color: #7d9029; } /* Attribute */
code > span.do { color: #ba2121; font-style: italic; } /* Documentation */
code > span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code > span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code > span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
</style>



<link href="data:text/css;charset=utf-8,body%20%7B%0Abackground%2Dcolor%3A%20%23fff%3B%0Amargin%3A%201em%20auto%3B%0Amax%2Dwidth%3A%20700px%3B%0Aoverflow%3A%20visible%3B%0Apadding%2Dleft%3A%202em%3B%0Apadding%2Dright%3A%202em%3B%0Afont%2Dfamily%3A%20%22Open%20Sans%22%2C%20%22Helvetica%20Neue%22%2C%20Helvetica%2C%20Arial%2C%20sans%2Dserif%3B%0Afont%2Dsize%3A%2014px%3B%0Aline%2Dheight%3A%201%2E35%3B%0A%7D%0A%23header%20%7B%0Atext%2Dalign%3A%20center%3B%0A%7D%0A%23TOC%20%7B%0Aclear%3A%20both%3B%0Amargin%3A%200%200%2010px%2010px%3B%0Apadding%3A%204px%3B%0Awidth%3A%20400px%3B%0Aborder%3A%201px%20solid%20%23CCCCCC%3B%0Aborder%2Dradius%3A%205px%3B%0Abackground%2Dcolor%3A%20%23f6f6f6%3B%0Afont%2Dsize%3A%2013px%3B%0Aline%2Dheight%3A%201%2E3%3B%0A%7D%0A%23TOC%20%2Etoctitle%20%7B%0Afont%2Dweight%3A%20bold%3B%0Afont%2Dsize%3A%2015px%3B%0Amargin%2Dleft%3A%205px%3B%0A%7D%0A%23TOC%20ul%20%7B%0Apadding%2Dleft%3A%2040px%3B%0Amargin%2Dleft%3A%20%2D1%2E5em%3B%0Amargin%2Dtop%3A%205px%3B%0Amargin%2Dbottom%3A%205px%3B%0A%7D%0A%23TOC%20ul%20ul%20%7B%0Amargin%2Dleft%3A%20%2D2em%3B%0A%7D%0A%23TOC%20li%20%7B%0Aline%2Dheight%3A%2016px%3B%0A%7D%0Atable%20%7B%0Amargin%3A%201em%20auto%3B%0Aborder%2Dwidth%3A%201px%3B%0Aborder%2Dcolor%3A%20%23DDDDDD%3B%0Aborder%2Dstyle%3A%20outset%3B%0Aborder%2Dcollapse%3A%20collapse%3B%0A%7D%0Atable%20th%20%7B%0Aborder%2Dwidth%3A%202px%3B%0Apadding%3A%205px%3B%0Aborder%2Dstyle%3A%20inset%3B%0A%7D%0Atable%20td%20%7B%0Aborder%2Dwidth%3A%201px%3B%0Aborder%2Dstyle%3A%20inset%3B%0Aline%2Dheight%3A%2018px%3B%0Apadding%3A%205px%205px%3B%0A%7D%0Atable%2C%20table%20th%2C%20table%20td%20%7B%0Aborder%2Dleft%2Dstyle%3A%20none%3B%0Aborder%2Dright%2Dstyle%3A%20none%3B%0A%7D%0Atable%20thead%2C%20table%20tr%2Eeven%20%7B%0Abackground%2Dcolor%3A%20%23f7f7f7%3B%0A%7D%0Ap%20%7B%0Amargin%3A%200%2E5em%200%3B%0A%7D%0Ablockquote%20%7B%0Abackground%2Dcolor%3A%20%23f6f6f6%3B%0Apadding%3A%200%2E25em%200%2E75em%3B%0A%7D%0Ahr%20%7B%0Aborder%2Dstyle%3A%20solid%3B%0Aborder%3A%20none%3B%0Aborder%2Dtop%3A%201px%20solid%20%23777%3B%0Amargin%3A%2028px%200%3B%0A%7D%0Adl%20%7B%0Amargin%2Dleft%3A%200%3B%0A%7D%0Adl%20dd%20%7B%0Amargin%2Dbottom%3A%2013px%3B%0Amargin%2Dleft%3A%2013px%3B%0A%7D%0Adl%20dt%20%7B%0Afont%2Dweight%3A%20bold%3B%0A%7D%0Aul%20%7B%0Amargin%2Dtop%3A%200%3B%0A%7D%0Aul%20li%20%7B%0Alist%2Dstyle%3A%20circle%20outside%3B%0A%7D%0Aul%20ul%20%7B%0Amargin%2Dbottom%3A%200%3B%0A%7D%0Apre%2C%20code%20%7B%0Abackground%2Dcolor%3A%20%23f7f7f7%3B%0Aborder%2Dradius%3A%203px%3B%0Acolor%3A%20%23333%3B%0Awhite%2Dspace%3A%20pre%2Dwrap%3B%20%0A%7D%0Apre%20%7B%0Aborder%2Dradius%3A%203px%3B%0Amargin%3A%205px%200px%2010px%200px%3B%0Apadding%3A%2010px%3B%0A%7D%0Apre%3Anot%28%5Bclass%5D%29%20%7B%0Abackground%2Dcolor%3A%20%23f7f7f7%3B%0A%7D%0Acode%20%7B%0Afont%2Dfamily%3A%20Consolas%2C%20Monaco%2C%20%27Courier%20New%27%2C%20monospace%3B%0Afont%2Dsize%3A%2085%25%3B%0A%7D%0Ap%20%3E%20code%2C%20li%20%3E%20code%20%7B%0Apadding%3A%202px%200px%3B%0A%7D%0Adiv%2Efigure%20%7B%0Atext%2Dalign%3A%20center%3B%0A%7D%0Aimg%20%7B%0Abackground%2Dcolor%3A%20%23FFFFFF%3B%0Apadding%3A%202px%3B%0Aborder%3A%201px%20solid%20%23DDDDDD%3B%0Aborder%2Dradius%3A%203px%3B%0Aborder%3A%201px%20solid%20%23CCCCCC%3B%0Amargin%3A%200%205px%3B%0A%7D%0Ah1%20%7B%0Amargin%2Dtop%3A%200%3B%0Afont%2Dsize%3A%2035px%3B%0Aline%2Dheight%3A%2040px%3B%0A%7D%0Ah2%20%7B%0Aborder%2Dbottom%3A%204px%20solid%20%23f7f7f7%3B%0Apadding%2Dtop%3A%2010px%3B%0Apadding%2Dbottom%3A%202px%3B%0Afont%2Dsize%3A%20145%25%3B%0A%7D%0Ah3%20%7B%0Aborder%2Dbottom%3A%202px%20solid%20%23f7f7f7%3B%0Apadding%2Dtop%3A%2010px%3B%0Afont%2Dsize%3A%20120%25%3B%0A%7D%0Ah4%20%7B%0Aborder%2Dbottom%3A%201px%20solid%20%23f7f7f7%3B%0Amargin%2Dleft%3A%208px%3B%0Afont%2Dsize%3A%20105%25%3B%0A%7D%0Ah5%2C%20h6%20%7B%0Aborder%2Dbottom%3A%201px%20solid%20%23ccc%3B%0Afont%2Dsize%3A%20105%25%3B%0A%7D%0Aa%20%7B%0Acolor%3A%20%230033dd%3B%0Atext%2Ddecoration%3A%20none%3B%0A%7D%0Aa%3Ahover%20%7B%0Acolor%3A%20%236666ff%3B%20%7D%0Aa%3Avisited%20%7B%0Acolor%3A%20%23800080%3B%20%7D%0Aa%3Avisited%3Ahover%20%7B%0Acolor%3A%20%23BB00BB%3B%20%7D%0Aa%5Bhref%5E%3D%22http%3A%22%5D%20%7B%0Atext%2Ddecoration%3A%20underline%3B%20%7D%0Aa%5Bhref%5E%3D%22https%3A%22%5D%20%7B%0Atext%2Ddecoration%3A%20underline%3B%20%7D%0A%0Acode%20%3E%20span%2Ekw%20%7B%20color%3A%20%23555%3B%20font%2Dweight%3A%20bold%3B%20%7D%20%0Acode%20%3E%20span%2Edt%20%7B%20color%3A%20%23902000%3B%20%7D%20%0Acode%20%3E%20span%2Edv%20%7B%20color%3A%20%2340a070%3B%20%7D%20%0Acode%20%3E%20span%2Ebn%20%7B%20color%3A%20%23d14%3B%20%7D%20%0Acode%20%3E%20span%2Efl%20%7B%20color%3A%20%23d14%3B%20%7D%20%0Acode%20%3E%20span%2Ech%20%7B%20color%3A%20%23d14%3B%20%7D%20%0Acode%20%3E%20span%2Est%20%7B%20color%3A%20%23d14%3B%20%7D%20%0Acode%20%3E%20span%2Eco%20%7B%20color%3A%20%23888888%3B%20font%2Dstyle%3A%20italic%3B%20%7D%20%0Acode%20%3E%20span%2Eot%20%7B%20color%3A%20%23007020%3B%20%7D%20%0Acode%20%3E%20span%2Eal%20%7B%20color%3A%20%23ff0000%3B%20font%2Dweight%3A%20bold%3B%20%7D%20%0Acode%20%3E%20span%2Efu%20%7B%20color%3A%20%23900%3B%20font%2Dweight%3A%20bold%3B%20%7D%20%20code%20%3E%20span%2Eer%20%7B%20color%3A%20%23a61717%3B%20background%2Dcolor%3A%20%23e3d2d2%3B%20%7D%20%0A" rel="stylesheet" type="text/css" />

</head>

<body>




<h1 class="title toc-ignore">Searching DataONE Data Holdings</h1>
<h4 class="date"><em>2016-05-27</em></h4>



<p>The primary method to locate data in the DataONE network is to use the web based search tool located at <a href="https://search.dataone.org" class="uri">https://search.dataone.org</a>.</p>
<p>Data can also be discovered programatically from R using the <em>dataone</em> R package method <code>query</code>. Both the web page and the R method access the same underlying search mechanism, the Apache Foundation Solr search engine that runs on the <a href="https://www.dataone.org/coordinating-nodes">DataONE Coordinating Node</a>. The DataONE Solr index, similar to a catalog or database, contains information for every dataset that is available from the DataONE network.</p>
<p>The same search mechanism is available on <a href="https://www.dataone.org/current-member-nodes">DataONE Member Nodes</a>. However, the search index on a member node only contains dataset information for datasets that are contained on that member node.</p>
<p>Information about the Solr search engine can be obtained at <a href="http://lucene.apache.org/solr/resources.html">Solr Resources</a> and <a href="http://www.solrtutorial.com">Solr Tutorial</a></p>
<p>Additional information about searching DataONE can be viewed at <a href="https://purl.dataone.org/architecture/design/SearchMetadata.html">Content Discovery</a>.</p>
<div id="using-the-query-method" class="section level2">
<h2>Using The <code>query</code> Method</h2>
<p>Some familiarity with Solr is helpful when using the <code>query</code> method effectively, however basic queries can be very powerful and the examples in this document can provide a starting point. As an alternative to composing queries using Solr syntax, a simplier search mechanism is available with the <code>query</code> method that uses name, value pairs (See the section: *A Simplied Searchâ€œ).</p>
<p>Additional information about the <code>query</code> method can be obtained from the R help facility, e.g. <code>?query</code> from the R command line.</p>
<div id="query-and-return-an-r-list" class="section level3">
<h3>Query and return an R list</h3>
<p>The following example queries DataONE and returns values in an R list, with each value converted from the Solr result to the appropriate R data type:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(dataone)
cn &lt;-<span class="st"> </span><span class="kw">CNode</span>(<span class="st">&quot;PROD&quot;</span>)
queryParamList &lt;-<span class="st"> </span><span class="kw">list</span>(<span class="dt">q=</span><span class="st">&quot;id:doi*&quot;</span>, <span class="dt">rows=</span><span class="st">&quot;5&quot;</span>, <span class="dt">fq=</span><span class="st">&quot;abstract:carbon&quot;</span>, <span class="dt">fl=</span><span class="st">&quot;id,title,dateUploaded,abstract,datasource,size&quot;</span>)
result &lt;-<span class="st"> </span><span class="kw">query</span>(cn, <span class="dt">solrQuery=</span>queryParamList, <span class="dt">as=</span><span class="st">&quot;list&quot;</span>)</code></pre></div>
<p>The â€˜solrQueryâ€™ argument takes a list of query parameters that are sent to the DataONE Solr search engine and control how the search is performed. The name of each list element is a Solr keyword which is combined with the list element value to create each Solr query term. All these terms are combined to create the complete Solr query. The <code>queryParamlist</code> in the example above will be used to construct this Solr query:</p>
<pre><code>?q=id:doi*&amp;rows=5,&amp;fq=abstract:carbon&amp;fl=id,title,dateUploaded,abstract,datasource,size</code></pre>
<p>The <code>q=id:doi*</code> is the main query term and specifies that all DataONE objects that have an <code>id</code> field value beginning with <code>doi*</code> should be returned.</p>
<p>The <code>&amp;fq=abstract:carbon</code> term is a <code>filter query</code>, which filters the results so that only results with an <code>abstract</code> field containing the word <code>carbon</code> will be returned.</p>
<p>The <code>&amp;fl=id,title,dateUploaded,abstract,datasource,size</code> term is a <code>field</code> specifier, so only those fields in the list will be included in the result set.</p>
<p>The <code>&amp;rows=5</code> term specifies that a maximum of five results will be returned.</p>
<p>The <code>result</code> object contains all the data values found and returned from the query. Each element of the returned list contains information for one dataset. Each returned attribute for a dataset can be accessed with the appropriate element name, for example, to access the title information of the first dataset returned, use the R statement:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">result[[<span class="dv">1</span>]]$title</code></pre></div>
<p>To print out selected information for all returned values, use:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">ids &lt;-<span class="st"> </span><span class="kw">lapply</span>(result, function(x) {
  <span class="kw">message</span>(<span class="kw">sprintf</span>(<span class="st">&quot;id: %s&quot;</span>, x$id))
  <span class="kw">message</span>(<span class="kw">sprintf</span>(<span class="st">&quot;origin member node: %s&quot;</span>, x$datasource))
  <span class="kw">message</span>(<span class="kw">sprintf</span>(<span class="st">&quot;title: %s&quot;</span>, x$title))
  <span class="kw">message</span>(<span class="kw">sprintf</span>(<span class="st">&quot;date uploaded: %s&quot;</span>, x$dateUploaded))
  x$id
})</code></pre></div>
<p>The complete list of possible searchable values stored for a dataset can be viewed at <a href="https://cn.dataone.org/cn/v2/query/solr">DataONE Solr Engine Description</a>. However, the values available for a particular dataset may be a subset of these, depending on the metadata provided when the dataset is uploaded to DataONE.</p>
<p>The DataONE Coordinating Node (CN) contains metadata about datasets from all Member Nodes (MN) in the network. As the above example shows, sending a query to the CN may find matching datasets located on potentially any Member Node in the network.</p>
</div>
<div id="return-values-as-a-data-frame" class="section level3">
<h3>Return values as a data frame</h3>
<p>To return results as a data frame, use the <code>as</code> parameter as shown below. In addition all values will be stored as <code>character</code>, because <code>parse=FALSE</code> is specified:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">cn &lt;-<span class="st"> </span><span class="kw">CNode</span>(<span class="st">&quot;PROD&quot;</span>)
result &lt;-<span class="st"> </span><span class="kw">query</span>(cn, queryParamList, <span class="dt">as=</span><span class="st">&quot;data.frame&quot;</span>, <span class="dt">parse=</span><span class="ot">FALSE</span>)</code></pre></div>
<p>The <code>result</code> is a data frame with each row containing information for one dataset. To print all returned DataONE identifiers from the result:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">result[,<span class="st">'id'</span>]</code></pre></div>
</div>
<div id="using-a-simplified-search." class="section level3">
<h3>Using a Simplified Search.</h3>
<p>A search may be performed by just specifying query fields and values using the <em>searchTerms</em> parameter. For example, to search for datasets that mention â€˜kelpâ€™ in the abstract and have an attribute discription that contains the word â€˜biomassâ€™, the following query could be used:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">cn &lt;-<span class="st"> </span><span class="kw">CNode</span>(<span class="st">&quot;PROD&quot;</span>)
mn &lt;-<span class="st"> </span><span class="kw">getMNode</span>(cn, <span class="st">&quot;urn:node:KNB&quot;</span>)
mySearchTerms &lt;-<span class="st"> </span><span class="kw">list</span>(<span class="dt">abstract=</span><span class="st">&quot;kelp&quot;</span>, <span class="dt">attribute=</span><span class="st">&quot;biomass&quot;</span>)
result &lt;-<span class="st"> </span><span class="kw">query</span>(cn, <span class="dt">searchTerms=</span>mySearchTerms, <span class="dt">as=</span><span class="st">&quot;data.frame&quot;</span>)</code></pre></div>
<p>Using the <em>searchTerms</em> parameter causes the <em>query</em> method to construct a Solr query based on the list, that is passed on to the DataONE node specified.</p>
<p>The names in the <em>searchTerm</em> list are the query field names available from the Solr query engine being used. These names can be determined using the <em>queryEngineDescription</em> method, or simply using a web browser to view <a href="https://cn.dataone.org/cn/v2/query/solr" class="uri">https://cn.dataone.org/cn/v2/query/solr</a>.</p>
</div>
<div id="search-just-a-member-node" class="section level3">
<h3>Search just a member node</h3>
<p>If it is known which Member Node holds the data of interest, then a search can be limited to just that MN by sending the search directly to that MN instead of the CN. For example, if the dataset of interest is on The Knowledge Network for Biocomplexity (KNB) Member Node, then the search is performed with the statments:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># Query the data holdings on a member node</span>
cn &lt;-<span class="st"> </span><span class="kw">CNode</span>(<span class="st">&quot;PROD&quot;</span>)
mn &lt;-<span class="st"> </span><span class="kw">getMNode</span>(cn, <span class="st">&quot;urn:node:KNB&quot;</span>)
queryParams &lt;-<span class="st"> </span><span class="kw">list</span>(<span class="dt">q=</span><span class="st">&quot;abstract:habitat&quot;</span>, <span class="dt">fl=</span><span class="st">&quot;id,title,abstract&quot;</span>) 
result &lt;-<span class="st"> </span><span class="kw">query</span>(mn, queryParams, <span class="dt">as=</span><span class="st">&quot;data.frame&quot;</span>, <span class="dt">parse=</span><span class="ot">FALSE</span>)
<span class="co"># Choose the first matchin PID</span>
pid &lt;-<span class="st"> </span>result[<span class="dv">1</span>,<span class="st">'id'</span>]</code></pre></div>
</div>
<div id="filter-query-results-for-a-specific-member-node" class="section level3">
<h3>Filter query results for a specific member node</h3>
<p>An alternative way to locate datasets on a particular node is to send the query to the CN but limit the returned results to data holdings that originated from the specific member node by using Solr filter query parameter (<code>&amp;fq</code>) can be used for the <code>datasource</code> field:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">cn &lt;-<span class="st"> </span><span class="kw">CNode</span>(<span class="st">&quot;PROD&quot;</span>)
queryParams &lt;-<span class="st"> 'q=id:*&amp;fl=id,title&amp;fq=datasource:&quot;urn:node:KNB&quot;&amp;rows=5'</span>
result &lt;-<span class="st"> </span><span class="kw">query</span>(cn, queryParams, <span class="dt">as=</span><span class="st">&quot;data.frame&quot;</span>, <span class="dt">parse=</span><span class="ot">FALSE</span>)
result[,<span class="st">'id'</span>]</code></pre></div>
</div>
</div>



<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
